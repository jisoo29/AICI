{% load static %}

<!DOCTYPE html>
<html style="min-height: 100vh;">
    <head lang="ko">
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM" crossorigin="anonymous">
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js" integrity="sha384-geWF76RCwLtnZ8qwWowPQNguL3RmwHVBC9FhGdlKrxdiJJigb/j/68SIy3Te4Bkz" crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js" integrity="sha384-IQsoLXl5PILFhosVNubq5LC7Qb9DXgDA9i+tQ8Zj3iwWAwPtgFTxbJ8NT4GN1R8p" crossorigin="anonymous"></script>
        
        <!-- bootstrap 아이콘 -->
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">

        <!-- jqueary -->
        <script src="https://code.jquery.com/jquery-latest.min.js"></script>
        <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-json/2.6.0/jquery.json.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/json2/20160511/json2.min.js"></script>

        <!-- favicon -->
        <link rel="shortcut icon" href="{% static 'favicon/favicon_square.png' %}"/>
  
    
        <title>AICI : 공지사항 > 게시글 수정</title>
        
        <style>

            i {
                font-size: 28px;
            }

            .btn-bd-primary {
                --bs-btn-font-weight: 600;
                --bs-btn-color: white;
                --bs-btn-bg: #304070;
                --bs-btn-border-color: #304070;
                --bs-btn-hover-color: var(--bs-white);
                --bs-btn-hover-bg: #8EC0E4;
                --bs-btn-hover-border-color: #8EC0E4;
                --bs-btn-focus-shadow-rgb: var(--bd-violet-rgb);
                --bs-btn-active-color: var(--bs-btn-hover-color);
                --bs-btn-active-bg: #8EC0E4;
                --bs-btn-active-border-color: #8EC0E4;
              }
            
            .btn-current {
                --bs-btn-font-weight: 600;
                --bs-btn-color: #ffffff;
                --bs-btn-bg:  #8EC0E4;
                --bs-btn-border-color:  #8EC0E4;
                --bs-btn-hover-color: var(--bs-white);
                --bs-btn-hover-bg: #8EC0E4;
                --bs-btn-hover-border-color: #8EC0E4;
                --bs-btn-focus-shadow-rgb: var(--bd-violet-rgb);
                --bs-btn-active-color: var(--bs-btn-hover-color);
                --bs-btn-active-bg: #8EC0E4;
                --bs-btn-active-border-color: #8EC0E4;
            }

            a {
                text-decoration: none;
                color: black;
            }

        </style>
    </head>
    <body style="min-height: 100vh;">

        <header>
            <!-- 상단바 -->
            <nav class="navbar navbar-expand-lg  border-bottom">
                <div class="container-fluid row">
                    <div class="col-2 row">
                        {% comment %} 로고 {% endcomment %}
                        <div>
                            <a href="/"><img src="{% static 'logo_7.png' %}" class="w-50" id="logo"></a>
                        </div>
                    </div>
                    <div class="col">
                        {% if request.user.is_authenticated %}
                            <h5 class="m-0"><p style="display: inline;">{{ request.user.name }}</p> 엔지니어님, 환영합니다.</h5>    
                        {% else %}
                            <p>User is not logged in</p>
                        {% endif %}
                    </div>
                    <div class="col-auto">
                        <div class="collapse navbar-collapse" id="navbarNav">
                            <ul class="navbar-nav">
                                <li class="nav-item">
                                    <a class="nav-link me-2" href="/users/logout"><i class="bi bi-box-arrow-right"></i></a>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </nav>

        </header>

        <div class="row container-fluid p-0 m-0" style="min-height: 100vh;">
            <!-- 사이드바 -->
            <div class="col-md-1 border-end text-center">

                <!-- 아이콘 -->
                <div>
                    <ul class="nav flex-column">
                        <!-- 홈 -->
                        <li class="nav-item m-2">
                            <a class="nav-link active mt-4" aria-current="page" href="/">
                                <button type="button" class="btn btn-bd-primary rounded-circle" style="width: 50px; height: 50px;" onclick ="location.href='/home'">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-house" viewBox="0 0 16 16">
                                        <path d="M8.707 1.5a1 1 0 0 0-1.414 0L.646 8.146a.5.5 0 0 0 .708.708L2 8.207V13.5A1.5 1.5 0 0 0 3.5 15h9a1.5 1.5 0 0 0 1.5-1.5V8.207l.646.647a.5.5 0 0 0 .708-.708L13 5.793V2.5a.5.5 0 0 0-.5-.5h-1a.5.5 0 0 0-.5.5v1.293L8.707 1.5ZM13 7.207V13.5a.5.5 0 0 1-.5.5h-9a.5.5 0 0 1-.5-.5V7.207l5-5 5 5Z"/>
                                    </svg>
                                </button>
                            </a>
                        </li>
                        <!-- 공지사항 -->
                        <li class="nav-item m-2">
                            <a class="nav-link mt-4" href="#">
                                <button type="button" class="btn btn-current rounded-circle" style="width: 50px; height: 50px;" onclick ="location.href='/board'">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-megaphone" viewBox="0 0 16 16">
                                        <path d="M13 2.5a1.5 1.5 0 0 1 3 0v11a1.5 1.5 0 0 1-3 0v-.214c-2.162-1.241-4.49-1.843-6.912-2.083l.405 2.712A1 1 0 0 1 5.51 15.1h-.548a1 1 0 0 1-.916-.599l-1.85-3.49a68.14 68.14 0 0 0-.202-.003A2.014 2.014 0 0 1 0 9V7a2.02 2.02 0 0 1 1.992-2.013 74.663 74.663 0 0 0 2.483-.075c3.043-.154 6.148-.849 8.525-2.199V2.5zm1 0v11a.5.5 0 0 0 1 0v-11a.5.5 0 0 0-1 0zm-1 1.35c-2.344 1.205-5.209 1.842-8 2.033v4.233c.18.01.359.022.537.036 2.568.189 5.093.744 7.463 1.993V3.85zm-9 6.215v-4.13a95.09 95.09 0 0 1-1.992.052A1.02 1.02 0 0 0 1 7v2c0 .55.448 1.002 1.006 1.009A60.49 60.49 0 0 1 4 10.065zm-.657.975 1.609 3.037.01.024h.548l-.002-.014-.443-2.966a68.019 68.019 0 0 0-1.722-.082z"/>
                                    </svg>
                                </button>
                            </a>
                        </li>
                        <!-- TM 확인 -->
                        <li class="nav-item m-2">
                            <a class="nav-link mt-4" href="#">
                                <button type="button" class="btn btn-bd-primary rounded-circle" style="width: 50px; height: 50px;" onclick ="location.href='/voc'">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-telephone" viewBox="0 0 16 16">
                                        <path d="M3.654 1.328a.678.678 0 0 0-1.015-.063L1.605 2.3c-.483.484-.661 1.169-.45 1.77a17.568 17.568 0 0 0 4.168 6.608 17.569 17.569 0 0 0 6.608 4.168c.601.211 1.286.033 1.77-.45l1.034-1.034a.678.678 0 0 0-.063-1.015l-2.307-1.794a.678.678 0 0 0-.58-.122l-2.19.547a1.745 1.745 0 0 1-1.657-.459L5.482 8.062a1.745 1.745 0 0 1-.46-1.657l.548-2.19a.678.678 0 0 0-.122-.58L3.654 1.328zM1.884.511a1.745 1.745 0 0 1 2.612.163L6.29 2.98c.329.423.445.974.315 1.494l-.547 2.19a.678.678 0 0 0 .178.643l2.457 2.457a.678.678 0 0 0 .644.178l2.189-.547a1.745 1.745 0 0 1 1.494.315l2.306 1.794c.829.645.905 1.87.163 2.611l-1.034 1.034c-.74.74-1.846 1.065-2.877.702a18.634 18.634 0 0 1-7.01-4.42 18.634 18.634 0 0 1-4.42-7.009c-.362-1.03-.037-2.137.703-2.877L1.885.511z"/>
                                    </svg>
                                </button>
                            </a>
                        </li>
                        <!-- 시외공사 -->
                        <li class="nav-item m-2">
                            <a class="nav-link mt-4" href="#">
                                <button type="button" class="btn btn-bd-primary rounded-circle" style="width: 50px; height: 50px;" onclick ="location.href='/construction'">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-geo-alt-fill" viewBox="0 0 16 16">
                                        <path d="M8 16s6-5.686 6-10A6 6 0 0 0 2 6c0 4.314 6 10 6 10zm0-7a3 3 0 1 1 0-6 3 3 0 0 1 0 6z"/>
                                      </svg>
                                </button>
                            </a>   
                        </li>
                      </ul>
                </div>
            </div>

            <!-- 메인 컨텐츠 -->
            <div class="col p-0" style="background-color:#F1F2F6;">

                <!-- 메인 내용 -->

                <div class="container border rounded-3 w-75 p-5 mt-5 mb-5" style="background-color:white;">
                    <div class="mb-2">
                        <div class="ps-4 pe-4 pb-3 row">
                            <div class="col-4">
                                <h4 style="display:inline;">공지사항</h4> <i class="bi bi-chevron-compact-right" style="font-size: 16px;"></i> 게시글 보기
                            </div>

                            <!-- 목록으로 -->
                            <div class="d-flex justify-content-end col">
                                <button type="submit" class="btn btn-secondary btn" onclick ="location.href='/board'"> 목록 </button>
                            </div>
                        </div>
                    </div>

                    <form class="ps-4 pe-4" id="myForm" enctype="multipart/form-data"method = "post" action = "/board/content/{{ BoardTB.brd_id }}/edit/">
                        {% csrf_token %}
                        <div>
                            <table class="table table-light table-borderless border" style="border-collapse: separate; border-spacing: 0;">
                                <tbody>
                                    <colgroup>
                                        <col width=20%>
                                        <col width=80%>
                                    </colgroup>
                                    <tr>
                                        <td class="align-middle text-center">제목</td>
                                        <td><textarea class="form-control" id="brd_title" name="brd_title" maxlength="20" style="resize: none; height:10px;">{{ data.brd_title }}</textarea></td>
                                        
                                    </tr>
                                    <tr class="mb-4">
                                        <td class="align-middle text-center">내용</td>
                                        <td><textarea class="form-control h-50" id="brd_content" name="brd_content" rows="20" style="resize: none;">{{ data.brd_content }}</textarea></td>
                                    </tr>
                                </tbody>
                            </table>
                            <div class="mb-3">
                                <input type="file" id="file" name="file" class="form-control">
                            </div>
                        </div>
                        {% if data.engineer.name == request.user.name %}
                            <div class="row row-cols-auto d-flex justify-content-end">
                                <!-- 수정하기 -->
                                <div class="col p-0">
                                    <button type="submit" class="btn btn-secondary btn m-0" onclick ="edit_btn()">수정완료</button>
                                </div>
                            </div>
                        {% else %}
                        {% endif %}
                    </form>
                </div>
                <!-- Footer -->
                <footer
                        class="text-center text-lg-start text-white"
                        style="background-color: #9baec8;"
                        >
                    <!-- Grid container -->
                    <div class="p-3 pb-3">
                        <section class="">
                        <div class="row column-gap-5">
                            <div class="col 6mx-auto mt-3">
                            </div>
                            <!-- Grid column -->
                            <div class="col-md-5 col-lg-5 col-xl-5 ms-5 mx-auto mt-3 text-center">
                                <div class="row text-center">
                                    <h6 class="col text-uppercase mb-4 font-weight-bold">
                                        <a href="/users/privacy_policy" style="color:white;">Privacy Policy</a>
                                    </h6>
                                    <h6 class="col text-uppercase mb-4 font-weight-bold">
                                        <a href="/users/terms_of_service" style="color:white;">Terms of Service</a>
                                    </h6>
                                    <h6 class="col text-uppercase mb-4 font-weight-bold">
                                        <a href="/users/aboutus" style="color:white;">About us</a>
                                    </h6>
                                </div>
                                <div
                                    class="text-center p-3" >
                                    2023 AICI_36 Corp. All rights reserved.
                                </div>
                            </div>
                            <div class="col mx-auto ms-5 mt-3 text-center">
                                <div class="ms-5">
                                    <h6 class="text-uppercase font-weight-bold">Follow us</h6>
                                    <a
                                        class="btn-floating mb-4 rounded-circle"
                                        href="https://github.com/jisoo29/AI_36_Project"
                                        role="button"
                                        ><i class="bi bi-github" style="font-size:2.3rem; color:white;"></i
                                        ></a>
                                </div>
                            </div>
                        </div>
                        </section>
                    </div>
                </footer>
            </div>
        </div>
    </body>
</html>

<script>
    function edit_btn() {
        var returnValue = confirm('수정하시겠습니까?');
        if (returnValue) {
            event.preventDefault(); // 기본 동작 중지
            post(); // 게시글 전송
            alert('수정이 완료되었습니다.');
            window.location.href = '/board/';
            //window.history.back()
        } else {
            // 취소 버튼을 눌렀을 때의 동작
            event.preventDefault(); // 기본 동작 중지
        };
    };

    function post() {
        // 폼 데이터 가져오기
        var formData = new FormData($('#myForm')[0]);

        var fileInput = document.getElementById('file');
        var file = fileInput.files[0]; // 파일 선택

        if (file) {
            formData.append('file', file);
        } else {
            formData.delete('file'); // 파일 필드 제거
        }

        // AJAX 요청 보내기
        $.ajax({
            url: '/board/content/{{ data.brd_id }}/edit/',
            type: 'POST',
            data: formData,
            dataType: 'json',
            success: function(response) {
                // 응답 처리
                if (response.message === '게시물이 성공적으로 수정되었습니다.') {
                    // 게시 성공
                    window.location.href = '/board'; // 공지사항 페이지로 이동
                } else {
                    // 게시 실패
                    alert('게시글을 게시하는데 실패하였습니다.');
                }
            },
            error: function(xhr, status, error) {
                // 요청 실패
                alert('요청 실패');
                console.log('Error:', error);
            },
            processData: false,
            contentType: false
        });
    };
</script>
